<Page
    x:Class="UniversalConverter.ConverterPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:UniversalConverter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    AllowDrop="True" Drop="Page_Drop" DragOver="Page_DragOver">

    <Page.Resources>
        <local:ObjectToVisibilityConverter x:Key="ObjectToVisibilityConverter"/>
        <x:String x:Key="OutputFormats">GIF,WEBP,JPG,PNG</x:String>
    </Page.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ProgressRing IsActive="{Binding IsBusy}" HorizontalAlignment="Center" VerticalAlignment="Center" Grid.RowSpan="5" />

        <!-- Controles de Preset e Seleção de Arquivo -->
        <StackPanel Grid.Row="0" Orientation="Vertical" Spacing="10">
            <TextBlock x:Uid="ConverterTitle" Style="{StaticResource TitleTextBlockStyle}"/>
            <StackPanel Orientation="Horizontal" Spacing="10">
                <ComboBox x:Uid="PresetComboBox" Header="Presets" Width="200"
                          ItemsSource="{Binding Presets}"
                          SelectedItem="{Binding SelectedPreset, Mode=TwoWay}"
                          DisplayMemberPath="Name"/>
                <Button x:Uid="SavePresetButton" Command="{Binding SavePresetCommand}">
                    <SymbolIcon Symbol="Save"/>
                </Button>
                <Button x:Uid="DeletePresetButton" Command="{Binding DeletePresetCommand}">
                    <SymbolIcon Symbol="Delete"/>
                </Button>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Command="{Binding SelectFileCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <SymbolIcon Symbol="OpenFile"/>
                        <TextBlock x:Uid="SelectFileButtonText" Text="Select File"/>
                    </StackPanel>
                </Button>
                <Button Command="{Binding SelectFolderCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <SymbolIcon Symbol="OpenFolder"/>
                        <TextBlock x:Uid="SelectFolderButtonText" Text="Select Folder"/>
                    </StackPanel>
                </Button>
                <CheckBox x:Uid="KeepStructureCheckBox" VerticalAlignment="Center" Margin="10,0,0,0" IsChecked="{Binding Options.KeepFolderStructure, Mode=TwoWay}"/>
            </StackPanel>
        </StackPanel>

        <!-- Opções de Conversão -->
        <StackPanel Grid.Row="1" Orientation="Vertical" Spacing="10" Margin="0,20,0,0">
            <TextBlock x:Uid="ConversionOptionsTitle" Style="{StaticResource SubtitleTextBlockStyle}"/>
            <ComboBox x:Uid="OutputFormatComboBox" PlaceholderText="Select format" Width="200"
                      ItemsSource="{Binding Source={StaticResource OutputFormats}}"
                      SelectedItem="{Binding SelectedOutputFormat, Mode=TwoWay}"
                      SelectionChanged="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>

            <Slider x:Uid="WebpQualitySlider" Width="300"
                    Value="{Binding Options.WebpQuality, Mode=TwoWay}"
                    Visibility="{Binding SelectedOutputFormat, Converter={StaticResource ObjectToVisibilityConverter}, ConverterParameter='WEBP'}"
                    ValueChanged="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
            <Slider x:Uid="JpgQualitySlider" Width="300"
                    Value="{Binding Options.JpgQuality, Mode=TwoWay}"
                    Visibility="{Binding SelectedOutputFormat, Converter={StaticResource ObjectToVisibilityConverter}, ConverterParameter='JPG'}"
                    ValueChanged="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
            <Slider x:Uid="PngCompressionSlider" Minimum="0" Maximum="9" Width="300"
                    Value="{Binding Options.PngCompression, Mode=TwoWay}"
                    Visibility="{Binding SelectedOutputFormat, Converter={StaticResource ObjectToVisibilityConverter}, ConverterParameter='PNG'}"
                    ValueChanged="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
            <CheckBox x:Uid="GifLoopCheckBox" IsChecked="{Binding Options.GifLoop, Mode=TwoWay}"
                      Visibility="{Binding SelectedOutputFormat, Converter={StaticResource ObjectToVisibilityConverter}, ConverterParameter='GIF'}"
                      Click="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
        </StackPanel>

        <!-- Transformações -->
        <StackPanel Grid.Row="2" Orientation="Vertical" Spacing="10" Margin="0,20,0,0">
            <TextBlock x:Uid="TransformsTitle" Style="{StaticResource SubtitleTextBlockStyle}"/>
            <StackPanel Orientation="Horizontal" Spacing="20">
                <StackPanel Spacing="5">
                    <TextBlock x:Uid="ResizeTitle" Style="{StaticResource CaptionTextBlockStyle}"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <NumberBox x:Uid="WidthNumberBox" Value="{Binding Options.Width, Mode=TwoWay}" Width="120" SpinButtonPlacementMode="Compact"
                                   ValueChanged="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
                        <NumberBox x:Uid="HeightNumberBox" Value="{Binding Options.Height, Mode=TwoWay}" Width="120" SpinButtonPlacementMode="Compact"
                                   ValueChanged="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
                        <CheckBox x:Uid="AspectRatioCheckBox" IsChecked="{Binding Options.KeepAspectRatio, Mode=TwoWay}" VerticalAlignment="Bottom" Margin="0,0,0,8"
                                  Click="{x:Bind ViewModel.OptionChangedCommand.Execute(null)}"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel Spacing="5">
                    <TextBlock x:Uid="RotateTitle" Style="{StaticResource CaptionTextBlockStyle}"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <Button x:Uid="RotateLeftButton" Command="{Binding RotateLeftCommand}">
                            <SymbolIcon Symbol="Rotate"/>
                        </Button>
                        <Button x:Uid="RotateRightButton" Command="{Binding RotateRightCommand}">
                            <SymbolIcon Symbol="Rotate">
                                <SymbolIcon.RenderTransform>
                                    <ScaleTransform ScaleX="-1" />
                                </SymbolIcon.RenderTransform>
                            </SymbolIcon>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <!-- Previews -->
        <Grid Grid.Row="3" Margin="0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0" Margin="0,0,5,0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4">
                <StackPanel>
                    <TextBlock x:Uid="OriginalPreviewTitle" HorizontalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}" Margin="5"/>
                    <Image Source="{Binding OriginalPreviewImage, Mode=OneWay}" Stretch="Uniform" />
                </StackPanel>
            </Border>
            <Border Grid.Column="1" Margin="5,0,0,0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4">
                <StackPanel>
                    <TextBlock x:Uid="ConvertedPreviewTitle" HorizontalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}" Margin="5"/>
                    <Image Source="{Binding ConvertedPreviewImage, Mode=OneWay}" Stretch="Uniform" />
                </StackPanel>
            </Border>
            <TextBlock x:Uid="PreviewTextBlock" Grid.ColumnSpan="2" HorizontalAlignment="Center" VerticalAlignment="Center" Style="{StaticResource SubtitleTextBlockStyle}"
                       Visibility="{Binding OriginalPreviewImage, Converter={StaticResource ObjectToVisibilityConverter}, ConverterParameter={x:Null}}"/>
        </Grid>

        <!-- Botão de Conversão -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10">
            <Button Style="{StaticResource AccentButtonStyle}" Command="{Binding ConvertCommand}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <SymbolIcon Symbol="Switch"/>
                    <TextBlock x:Uid="ConvertButtonText" Text="Convert"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>
</Page>